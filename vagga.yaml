containers:
  copyright-header:
    setup:
    - !UbuntuRelease { version: 15.10 }
    - !UbuntuUniverse
    - !Install [ ca-certificates, ruby, ruby-dev, zlib1g-dev, make, build-essential, libicu-dev ]
    - !Sh gem install copyright-header

  build:
    setup:
    - !UbuntuRelease { version: 15.10 }
    - !UbuntuUniverse
    - !Install [ ca-certificates, make, cmake, clang, gcc, g++, libboost-all-dev, gdbserver,
                 haskell-platform, rsync, python-pip ]
    - !Env
      HOME: /root # For cabal
    - !Sh |
        cabal update
        cabal install filemanip megaparsec shake text
        pip install sphinx sphinx-autobuild

    volumes:
      /tmp: !Tmpfs {size: 1Gi}

commands:
  add-copyright-headers: !Command
    description: Add copyright header to C++ files
    accepts-arguments: true
    container: copyright-header
    work-dir: .
    run: copyright-header/add-header "$@"
  shake: !Command
    description: Build and test everything
    accepts-arguments: true
    container: build
    work-dir: haskell
    environ: { HOME: /root }
    run: ./Build.hs "$@"
